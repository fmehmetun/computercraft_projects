-- Get arguments.
__modemSide = ...

-- Util functions
function __isEmpty(s)
  return (s == null or s == "")
end

-- Default arguments, if not specified.
if __isEmpty(__modemSide) then
  __modemSide = "right"
end

__receiveProtocol = "remote_exec"
__tempFileName = "remote_exec_tmp"
__tempFilePath = "/" .. __tempFileName

-- Open modem
rednet.open(__modemSide)

if rednet.isOpen(__modemSide) then
  print("[*] Modem is ready, listening for commands.")
  print("[*] My computer ID: " .. tostring(os.getComputerID()))
  
  while true do
    -- Only accept given protocol
    __senderId, __message, __protocol = rednet.receive(__receiveProtocol)
    
    -- Write the code to temporary file
    file = fs.open(__tempFilePath, "w")
    file.write(__message)
    file.close()
    
    -- Execute remote code
    print("[+] Executing remote code...")
    shell.run(__tempFilePath)
  
    -- Delete file
    fs.delete(__tempFilePath)
    
    print("[*] Waiting for commands again...")
    print("[*] My computer ID: " .. tostring(os.getComputerID()))
  end
end

rednet.close(__modemSide)